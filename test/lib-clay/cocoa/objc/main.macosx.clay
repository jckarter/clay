import cocoa.objc.*;
import printer.(println);


override selector("alloc") = Id;
override selector("init") = Id;
override selector("description") = NSString;
override selector("retain") = Id;
override selector("release") = Id;
override selector("autorelease") = Id;
override selector("class") = Id; // XXX class

override selector("stringWithUTF8String:") = Id, Pointer[CChar];
override varargSelector("stringWithFormat:") = Id, NSString; 
override selector("UTF8String") = Pointer[CChar];

override selector("numberWithInt:") = Id, Int;

override selector("drain") = Void;

record NSObject = externalClass(Void);
override externalClassMethod(#NSObject, "alloc") = Id;
override externalClassMethod(#NSObject, "class") = Id; // XXX Class
override externalInstanceMethod(#NSObject, "init") = Id;
override externalInstanceMethod(#NSObject, "description") = NSString;
override externalInstanceMethod(#NSObject, "retain") = Id;
override externalInstanceMethod(#NSObject, "release") = Id;
override externalInstanceMethod(#NSObject, "autorelease") = Id;
override externalInstanceMethod(#NSObject, "class") = Id; // XXX Class

record NSString = externalClass(NSObject);
override externalClassMethod(#NSString, "stringWithUTF8String:")
    = Id, Pointer[CChar];
override externalVarargClassMethod(#NSString, "stringWithFormat:")
    = Id, NSString;
override externalInstanceMethod(#NSString, "UTF8String")
    = Pointer[CChar];

record NSNumber = externalClass(NSObject);
override externalClassMethod(#NSNumber, "numberWithInt:") = Id, Int;

record NSAutoreleasePool = externalClass(NSObject);
override externalInstanceMethod(#NSNumber, "drain") = Void;

main() {
    var pool = NSAutoreleasePool.alloc().init();

    var format = NSString.stringWithUTF8String(cstring("%@ didn't start the fire"));
    var n = NSNumber.numberWithInt(451);

    var formattedString = NSString.stringWithFormat(format, n);

    println(CStringRef(formattedString.UTF8String()));

    var formattedString2 = NSString.stringWithFormat(format, NSSTR("Wii"));

    println(CStringRef(formattedString2.UTF8String()));

    pool.drain();
}
